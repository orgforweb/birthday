Theme=(function(){var b={particles:{name:"Hearts",defaultCount:1000,dynamic:{active:false,countIncrement:0.1,removeFactor:2},sprites:{url:"./res/FlutteringHeart.png",count:1,individualWidth:40,individualHeight:40},motion:{minVerticalVelocity:-4,maxVerticalVelocity:-2,minHorizontalVelocity:-2,maxHorizontalVelocity:2,minScale:0.4,maxScale:1.25,minHorizontalDelta:2,maxHorizontalDelta:3,minOpacity:0.2,maxOpacity:0.9,maxOpacityIncrement:50,speedFactor:0.6},landingProbability:0.5},gradient:{start:{red:255,green:250,blue:250},end:{red:245,green:105,blue:125},movingStop:{min:0.25,max:0.75,increment:0.0001}},postcard:{coverColor:"rgb(237,22,106)",fixedBounds:{width:500,height:500},image:{defaultMask:"./res/LargeHeartMaskBlurred.png",alternateMask:"./res/LargeBrokenHeartMaskBlurred.png"},marks:{minScale:0.5,maxScale:2,minOpacity:0.3,maxOpacity:0.9}},lights:[{color:"rgb(255,255,255)",topPosition:0.6,topRadius:20,bottomPosition:0.1,bottomPositionMin:0.1,bottomPositionMax:0.7,bottomPositionIncrement:0.01,bottomRadius:120,minOpacity:0.1,maxOpacity:0.5,opacityIncrement:0.001,opacity:0.1},{color:"rgb(255,255,255)",topPosition:0.4,topRadius:15,bottomPosition:0.8,bottomPositionMin:0.2,bottomPositionMax:0.8,bottomPositionIncrement:0.01,bottomRadius:150,minOpacity:0.1,maxOpacity:0.5,opacityIncrement:0.001,opacity:0.5}]};return{initialize:null,resources:b,apply:null}})();Classes=(function(){var n=" ";function k(a){return a.split(n)}function m(a){return a.join(n)}function o(a,b){if(!a||!b||!b.length){return false}return b.indexOf(a)}function p(c,a){if(!c||!c.className||!a){return}var b=k(c.className);return(o(a,b)>=0)}function l(c,a){if(!c||!a){return}if(!c.className){c.className=a}else{var b=k(c.className);if(o(a,b)===-1){b.push(a)}c.className=m(b)}return c.className}function i(c,a){if(!c||!c.className||!a){return}if(c.className===a){c.className=""}else{var b=k(c.className);b.splice(o(a,b),1);c.className=m(b)}return c.className}function j(b,a){if(!b||!a){return}if(p(b,a)){i(b,a)}else{l(b,a)}}return{add:l,remove:i,has:p,toggle:j,names:{hidden:"hidden"}}})();Animation=(function(){var s=[];var x=[];var o=false;var t;var p=16.7;var w=0;var u=60;var B=0;function q(a,b){if(a&&typeof(a)==="function"){s.push(a);x.push(b)}}function z(a){if(window.requestAnimationFrame){return window.requestAnimationFrame(a)}else{if(window.msRequestAnimationFrame){return window.msRequestAnimationFrame(a)}else{if(window.webkitRequestAnimationFrame){return window.webkitRequestAnimationFrame(a)}else{if(window.mozRequestAnimationFrame){return window.mozRequestAnimationFrame(a)}else{if(window.oRequestAnimationFrame){return window.oRequestAnimationFrame(a)}else{return setTimeout(a,p)}}}}}}function y(){var d=new Date();for(var c=0;c<s.length;c++){if(s[c]){s[c](x[c])}}if(o){t=z(y)}var a=new Date();var b=(a-d);w+=b;B++;if(B>=u){w=w/u;var e=Math.floor(1000/w);if(e>60){e=60}w=0;B=0}}function A(){if(o){return}t=z(y);o=true}function r(){if(!o){return}clearInterval(t);o=false}function v(){var a=(o)?r:A;a()}return{addFrameRenderer:q,start:A,stop:r,toggle:v,getRequestAnimationFrame:z}})();var Gfx=(function(){var m=30;var j;function n(){j=document.createElement("canvas");if(j){j.width=m*2;j.height=m*2;if(j.getContext){var a=j.getContext("2d");a.fillStyle="#ffffff";a.beginPath();a.arc(m,m,m,0,2*Math.PI,true);a.fill()}}}n();function l(b,d){var a=d.context;h(d);for(var c=0;c<b.length;c++){a.drawImage(j,b[c].x-m/2,b[c].y-m/2)}}function k(){var a={};a.clearContext=true;a.fillStyle="#000000";a.lineWidth=5;a.lineCap="round";a.lineJoin="round";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=15;a.shadowColor="#000000";a.globalCompositeOperation="source-over";a.globalAlpha="1.0";return a}function h(b){if(!b||!b.context){return}var a=b.context;a.fillStyle=b.fillStyle;a.lineWidth=b.lineWidth;a.lineCap=b.lineCap;a.lineJoin=b.lineJoin;a.shadowOffsetX=b.shadowOffsetX;a.shadowOffsetY=b.shadowOffsetY;a.shadowBlur=b.shadowBlur;a.shadowColor=b.shadowColor;a.globalCompositeOperation=b.globalCompositeOperation;a.globalAlpha=b.globalAlpha}function i(d,f){if(!d||!d.length||!d.length>1){return}var c=d,b=f,a=d[0];if(a.save){a.save()}for(var e=1;e<c.length;e++){if(b[e]){a.globalCompositeOperation=b[e]}a.drawImage(c[e],0,0)}if(a.restore){a.restore()}}return{renderPath:l,getDefaultRenderOptions:k,setRenderOptions:h,composeLayers:i}})();Postcard=(function(){var aq=Theme.resources.postcard;var W=aq.marks;var at=document.getElementById("postcardContainer");var T=document.getElementById("postcard");var ap=document.getElementById("message");var an,ab;var ax,U;var ak,av;var S,ay;var ao,am;var N;var ag=false;var Y;var ac=false;var ad=[];function X(a){Z(a)}function Q(){Animation.getRequestAnimationFrame(al)}function ai(a){ap.textContent=a}function aa(a){var b="Happy birthday to you, sweetheart, with all my love. My heart is always with you";return b}function al(){var a=Gfx.getDefaultRenderOptions();a.context=U;Gfx.renderPath(ad,a);ad=[];Gfx.composeLayers(b,c);var b=[ab,ak,ax,S];var c=["","","destination-out","destination-out"];Gfx.composeLayers(b,c)}function aj(){var a=document.createElement("canvas");a.width=T.clientWidth;a.height=T.clientHeight;return a}function ae(){ak=aj();ak.id="coverCanvas";av=ak.getContext("2d");av.fillStyle=aq.coverColor;av.fillRect(0,0,ak.width,ak.height)}function ar(a){S=aj();ay=S.getContext("2d");var b=document.createElement("img");b.onload=function(){ay.drawImage(b,0,0);ap.textContent=aa(a);ae();aw()};b.src=(a==="alternate")?aq.image.alternateMask:aq.image.defaultMask}function aw(){ax=aj();U=ax.getContext("2d");an=aj();an.className="clearCanvas";an.style.zIndex="1";T.appendChild(an);ab=an.getContext("2d");ag=true;al()}function V(a){return{x:a.clientX-Y.left,y:a.clientY-Y.top}}function au(a){ac=true;ad.push(V(a));Q()}function O(a){if(a.buttons>0){ac=true}if(ac){ad.push(V(a));Q()}}function M(a){ac=false;ad=[]}function Z(a){if(T.childNodes.length>0){T.innerHTML="";N=null;ag=false}ar(a);if(window.navigator.msPointerEnabled){at.addEventListener("MSPointerDown",au);at.addEventListener("MSPointerUp",M);at.addEventListener("MSPointerCancel",M);at.addEventListener("MSPointerMove",O)}else{at.addEventListener("mousedown",au);at.addEventListener("mouseup",M);at.addEventListener("mouseleave",M);at.addEventListener("mousemove",O)}}function R(f,a,c){var b=Math.random()*(W.maxScale-W.minScale)+W.minScale;var e=c.width;var d=c.height;if(U){U.globalAlpha=Math.random()*(W.maxOpacity-W.minOpacity)+W.minOpacity;U.globalCompositeOperation="destination-out";U.drawImage(c,0,0,e,d,f-e/2,a-d/2,e*b,d*b);Q()}}function af(){Y={width:aq.fixedBounds.width,height:aq.fixedBounds.height,left:(window.innerWidth-aq.fixedBounds.width)/2,right:(window.innerWidth+aq.fixedBounds.width)/2,top:(window.innerHeight-aq.fixedBounds.height)/2,bottom:(window.innerHeight+aq.fixedBounds.height)/2};return Y}function P(b,a){if(b<Y.left){return false}if(a<Y.top){return false}if(b>Y.right){return false}if(a>Y.bottom){return false}return true}function ah(g,a){if(ag&&!N){var h=ay.getImageData(0,0,S.width,S.height);N=[];for(var e=0;e<S.width;e++){N[e]=[];for(var c=0;c<S.height;c++){var b=h.data[e*4+c*(S.width*4)+3];N[e][c]=b}}}var d=Math.ceil(g-Y.left);var f=Math.ceil(a-Y.top);b=(N)?(N[d-1][f-1]>0):false;return b}return{show:X,placeMark:R,updateBounds:af,isWithinBounds:P,isWithinMaskedArea:ah,setPersonalizedMessage:ai}})();Particles=(function(){var q=[];var w=[];var v=Theme.resources.particles;var x=v.sprites;var s=v.motion;var D=v.dynamic;var F={width:window.innerWidth,height:window.innerHeight};var u;function t(c,a){var b=new Image();b.onload=function(){for(var d=0;d<x.count;d++){var e=document.createElement("canvas");e.width=x.individualWidth;e.height=x.individualHeight;var f=e.getContext("2d");f.drawImage(b,d*e.width,0,e.width,e.height,0,0,e.width,e.height);w.push(e)}if(c){v.defaultCount=c}if(!a){q=[]}for(var d=0;d<v.defaultCount;d++){q.push(y())}};b.src=x.url}function y(){var a=Math.random()*(s.maxScale-s.minScale)+s.minScale;return{x:Math.random()*F.width,y:Math.random()*F.height,vv:Math.random()*(s.maxVerticalVelocity-s.minVerticalVelocity)+s.minVerticalVelocity,hv:Math.random()*(s.maxHorizontalVelocity-s.minHorizontalVelocity)+s.minHorizontalVelocity,sw:a*x.individualWidth,sh:a*x.individualHeight,mhd:Math.random()*(s.maxHorizontalDelta-s.minHorizontalDelta)+s.minHorizontalDelta,hd:0,hdi:Math.random()/(s.maxHorizontalVelocity*s.minHorizontalDelta),o:Math.random()*(s.maxOpacity-s.minOpacity)+s.minOpacity,oi:Math.random()/s.maxOpacityIncrement,si:Math.ceil(Math.random()*(x.count-1)),nl:false}}function C(){for(var b=0;b<q.length;b++){var a=q[b];a.y+=a.vv*s.speedFactor;a.x+=(a.hd+a.hv)*s.speedFactor;a.hd+=a.hdi;if(a.hd<-a.mhd||a.hd>a.mhd){a.hdi=-a.hdi}a.o+=a.oi;if(a.o>s.maxOpacity||a.o<s.minOpacity){a.oi=-a.oi}if(a.o>s.maxOpacity){a.o=s.maxOpacity}if(a.o<s.minOpacity){a.o=s.minOpacity}var c=false;if(a.y>F.height+x.individualHeight/2){a.y=0;c=true}if(a.y<-a.sh){a.y=F.height;c=true}if(a.x>F.width+x.individualWidth/2){a.x=0;c=true}if(a.x<-a.sw){a.x=F.width;c=true}if(c){a.nl=false}if(!a.nl&&Postcard.isWithinBounds(a.x,a.y)&&!Postcard.isWithinMaskedArea(a.x,a.y)){var d=Math.random();if(d<v.landingProbability){Postcard.placeMark(Math.random()*u.width,Math.random()*u.height,w[a.si]);a.y=0;a.x=Math.random()*F.width}else{a.nl=true}}}}function E(c){C();c.clearRect(0,0,c.canvas.width,c.canvas.height);for(var b=0;b<q.length;b++){var a=q[b];c.globalAlpha=a.o;c.drawImage(w[a.si],0,0,x.individualWidth,x.individualWidth,a.x,a.y,a.sw,a.sh)}}function A(){F.width=window.innerWidth;F.height=window.innerHeight;u=Postcard.updateBounds()}function z(){return q.length}function r(a){if(!a){a=q.length*D.countIncrement}t(a,true)}function B(a){if(!a){a=q.length*D.countIncrement*D.removeFactor}if(q.length-a>0){q=q.slice(0,q.length-a)}}return{generate:t,add:r,remove:B,render:E,count:z,updateBounds:A}})();var Gradient=(function(){var q=Theme.resources.gradient;var l=q.movingStop.max;var n=q.start.red,k=q.start.green,p=q.start.blue;var o=q.end.red,m=q.end.green,j=q.end.blue;function r(c){c.clearRect(0,0,c.canvas.width,c.canvas.height);var f=c.createRadialGradient(c.canvas.width/2,(c.canvas.height-400)/2,0,c.canvas.width/2,c.canvas.height,c.canvas.height*1.5);var a=Math.ceil(255*(1-l));var b="rgba("+n+", "+k+","+p+","+l+")";var e="rgba("+o+", "+m+", "+j+", "+l/1.5+")";var d="rgba("+o+", "+m+", "+j+", "+l+")";f.addColorStop(0,b);f.addColorStop(l/2,e);f.addColorStop(l,d);l+=q.movingStop.increment;if(l>=q.movingStop.max||l<=q.movingStop.min){q.movingStop.increment=-q.movingStop.increment}c.fillStyle=f;c.fillRect(0,0,c.canvas.width,c.canvas.height)}return{render:r}})();Lights=(function(){var l=false;var h=Theme.resources.lights;function i(c,b){var d,a;switch(b){case"top":a=0;break;case"bottom":a=window.innerHeight;break}d=Math.ceil(c*window.innerWidth);return{x:d,y:a}}function j(a){a.opacity+=a.opacityIncrement;if(a.opacity>a.maxOpacity||a.opacity<a.minOpacity){a.opacityIncrement=-a.opacityIncrement}a.bottomPosition+=a.bottomPositionIncrement;if(a.bottomPosition>a.bottomPositionMax||a.bottomPosition<a.bottomPositionMin){a.bottomPositionIncrement=-a.bottomPositionIncrement}}function m(c){c.clearRect(0,0,c.canvas.width,c.canvas.height);if(!l){return}c.save();for(var b=0;b<h.length;b++){var e=h[b];var a=i(e.topPosition,"top");var d=i(e.bottomPosition,"bottom");c.beginPath();c.moveTo(a.x-e.topRadius,a.y);c.lineTo(a.x+e.topRadius,a.y);c.lineTo(d.x+e.bottomRadius,d.y);c.lineTo(d.x-e.bottomRadius,d.y);c.lineTo(a.x-e.topRadius,a.y);c.closePath();c.fillStyle=e.color;c.globalAlpha=e.opacity;c.fill();j(e)}c.restore()}function n(){l=true}function k(){l=false}return{render:m,activate:n,deactivate:k}})();var App=(function(){var ac=false;var Y=true;var aa=false;var N=112;var F=114;var M=false;var X;var J=document.getElementById("particlesCanvas");var G=document.getElementById("lightCanvas");var W=document.getElementById("backgroundGradient");var H,O,Z;if(J.getContext&&G.getContext&&W.getContext){H=J.getContext("2d");O=G.getContext("2d");Z=W.getContext("2d")}var K=document.getElementById("siParticlesCount");var P=document.getElementById("postcard");var I=document.getElementById("systemInformation");var C=document.getElementById("music");var ad=document.getElementById("muteControl");var Q=document.getElementById("messageTextEditor");var T=document.getElementById("copyPersonalURL");var R=document.getElementById("createPersonalMessage");var E=document.getElementById("copyResult");if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){Postcard.show("default");Particles.generate(250);ab();Animation.addFrameRenderer(Particles.render,H);Animation.addFrameRenderer(Gradient.render,Z);Animation.addFrameRenderer(Lights.render,O);Animation.start()})}else{var D=SystemInformation.getBrowser();if(D==="ie6"||D==="ie7"||D==="ie8"){var S=document.getElementById("compatibilityWarning");var V=document.getElementById("downloadModernMessage");var L=document.getElementById("downloadModernURL");if(S&&V&&L){Classes.remove(S,"hidden");V.innerText=Theme.resources.compatibility.downloadModernMessage;L.innerText=Theme.resources.compatibility.downloadModernURL;L.href=Theme.resources.compatibility.downloadModernURL;I.className="hidden";return}}}function ab(){var a=400;Postcard.updateBounds();Particles.updateBounds();J.width=window.innerWidth;J.height=window.innerHeight;W.width=window.innerWidth+a;W.height=window.innerHeight+a;G.width=window.innerWidth;G.height=window.innerHeight}if(document.addEventListener){document.addEventListener("keypress",function(b){if(M){return}if(b.keyCode===F){ac=!ac;if(ac){Postcard.show("alternate");C.src=Theme.resources.music.alternativeTrack;Lights.activate()}else{Postcard.show("default");C.src=Theme.resources.music.defaultTrack;Lights.deactivate()}}if(b.keyCode===N){Y=!Y;var a=(Y)?C.play():C.pause();if(a){a()}}},false)}var U=false;if(window.addEventListener){window.addEventListener("resize",function(){SystemInformation.post({width:window.innerWidth,height:window.innerHeight});ab()})}return{}})();
